<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🍭 Candy Crush - Kazanç Oyunu</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Candy Crush Styles -->
    <link rel="stylesheet" href="candy-styles.css">
    
    <!-- TronLink için -->
    <script src="https://cdn.jsdelivr.net/npm/tronweb@latest/dist/TronWeb.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="candy-styles.css">
</head>
<body>
    <div id="app">
        <!-- Yükleme ekranı -->
        <div id="loading-screen" class="loading-screen">
            <div class="loader"></div>
            <p>🍭 Candy Crush yükleniyor...</p>
            <p>💰 Oynayın ve USDT kazanın!</p>
        </div>

        <!-- Ana oyun ekranı -->
        <div id="game-container" class="game-container hidden">
            <!-- Üst bilgi çubuğu -->
            <div class="header">
                <div class="level-info">
                    <span id="level-display">Seviye: 1</span>
                    <span id="moves-display">Hamle: 30</span>
                </div>
                <div class="score-info">
                    <span id="score-display">Skor: 0</span>
                    <span id="coins-display" class="coins">💰 0</span>
                </div>
            </div>

            <!-- Hedef ve ilerleme -->
            <div class="target-section">
                <div class="target-info">
                    <span>Hedef: <span id="target-display">1000</span></span>
                </div>
                <div class="progress-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>

            <!-- Oyun tahtası -->
            <div id="game-board" class="game-board">
                <!-- Candy'ler JavaScript ile oluşturulacak -->
            </div>

            <!-- Alt menü -->
            <div class="bottom-menu">
                <button id="daily-bonus-btn" class="menu-btn">
                    🎁 Günlük Bonus
                </button>
                <button id="withdraw-btn" class="menu-btn withdraw-btn">
                    💳 Çek (USDT)
                </button>
                <button id="connect-wallet-btn" class="menu-btn wallet-btn">
                    🔗 Wallet Bağla
                </button>
            </div>

            <!-- Wallet bilgisi -->
            <div class="wallet-info">
                <span id="wallet-address">Wallet bağlanmamış</span>
            </div>
        </div>

        <!-- Level tamamlama modalı -->
        <div id="level-complete-modal" class="modal hidden">
            <div class="modal-content">
                <h2>🎉 Seviye Tamamlandı!</h2>
                <div class="completion-stats">
                    <div class="stat">
                        <span class="stat-label">Skor:</span>
                        <span id="level-score" class="stat-value">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Toplam Coin:</span>
                        <span id="level-coins" class="stat-value">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Çekilebilir:</span>
                        <span class="stat-value">
                            <span id="withdrawable-usdt">0</span> USDT
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game over modalı -->
        <div id="game-over-modal" class="modal hidden">
            <div class="modal-content">
                <h2>😢 Oyun Bitti</h2>
                <p>Hedefe ulaşamadınız!</p>
                <div class="completion-stats">
                    <div class="stat">
                        <span class="stat-label">Skor:</span>
                        <span id="final-score" class="stat-value">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Toplam Coin:</span>
                        <span id="final-coins" class="stat-value">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Çekim modalı -->
        <div id="withdraw-modal" class="modal hidden">
            <div class="modal-content">
                <h2>💳 USDT Çekimi</h2>
                <div class="withdraw-info">
                    <p>Çekilebilir miktar: <strong><span id="available-usdt">0</span> USDT</strong></p>
                    <p>Minimum çekim: <strong>5 USDT</strong></p>
                    <p>1000 Coin = 1 USDT</p>
                </div>
                
                <div class="withdraw-form">
                    <input type="number" id="withdraw-amount" placeholder="Çekim miktarı (USDT)" min="5">
                    <button id="process-withdraw-btn" class="action-btn primary">
                        ✅ Çekim Yap
                    </button>
                    <button id="close-withdraw-btn" class="action-btn secondary">
                        ❌ İptal
                    </button>
                </div>
                
                <div class="withdraw-note">
                    <small>💡 Çekim işlemleri 24 saat içinde TRON TRC20 ağından işlenir.</small>
                </div>
            </div>
        </div>

        <!-- Bonus kuralları modalı -->
        <div id="rules-modal" class="modal hidden">
            <div class="modal-content">
                <h2>🎮 Oyun Kuralları</h2>
                <div class="rules-content">
                    <h3>🍭 Nasıl Oynanır?</h3>
                    <ul>
                        <li>3 veya daha fazla aynı candy'yi eşleştirin</li>
                        <li>Her eşleştirmede coin kazanın</li>
                        <li>Hamle sayınız sınırlı, hedefi yakalamaya çalışın</li>
                    </ul>
                    
                    <h3>💰 Coin Kazanma Oranları</h3>
                    <ul>
                        <li>3'lü eşleştirme: 10 Coin</li>
                        <li>4'lü eşleştirme: 25 Coin</li>
                        <li>5'li+ eşleştirme: 50 Coin</li>
                        <li>Level tamamlama: 100 Coin</li>
                        <li>Günlük bonus: 100 Coin</li>
                    </ul>
                    
                    <h3>💳 USDT Çekimi</h3>
                    <ul>
                        <li>1000 Coin = 1 USDT</li>
                        <li>Minimum çekim: 5 USDT</li>
                        <li>TronLink wallet gerekli</li>
                        <li>24 saat içinde ödenir</li>
                    </ul>
                </div>
                
                <button id="close-rules-btn" class="action-btn primary">
                    ✅ Anladım
                </button>
            </div>
        </div>
    </div>

    <!-- Skor animasyonu için container -->
    <div id="score-animations"></div>

    <!-- Scripts -->
    <script src="candy-game.js"></script>
    
    <script>
        // Withdraw modal event listeners
        document.getElementById('close-withdraw-btn')?.addEventListener('click', () => {
            document.getElementById('withdraw-modal').classList.add('hidden');
        });
        
        document.getElementById('process-withdraw-btn')?.addEventListener('click', () => {
            const amount = document.getElementById('withdraw-amount').value;
            if (amount >= 5) {
                // CandyCrushGame instance'a erişim gerekebilir
                if (window.gameInstance) {
                    window.gameInstance.processWithdraw(parseFloat(amount));
                    document.getElementById('withdraw-modal').classList.add('hidden');
                }
            } else {
                alert('Minimum 5 USDT çekebilirsiniz!');
            }
        });
        
        document.getElementById('close-rules-btn')?.addEventListener('click', () => {
            document.getElementById('rules-modal').classList.add('hidden');
        });
        
        // Game instance'ı global olarak sakla
        document.addEventListener('DOMContentLoaded', () => {
            window.gameInstance = new CandyCrushGame();
        });
    </script>
</body>
</html>
